import { GuitarCombatApp } from "./app.js";

/**
 * –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Guitar Combat
 * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤—É—é –º–æ–¥—É–ª—å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å —Å–∏—Å—Ç–µ–º–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
 */

// –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
const app = new GuitarCombatApp();

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ DOM
document.addEventListener("DOMContentLoaded", async () => {
  try {
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    const config = {
      debug: true, // –í –±—Ä–∞—É–∑–µ—Ä–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ –≤—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–∞–µ–º debug
      maxEventHistory: 100,
      initialState: {
        settings: {
          beatCount: 8,
          bpm: 90,
          volume: {
            strum: 80,
            metronome: 100,
          },
        },
      },
      audio: {
        volume: 0.8,
        muteVolume: 0.3,
      },
      storage: {
        key: "guitarCombatData",
        autoSave: true,
        autoSaveDelay: 1000,
      },
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    const success = await app.initialize();

    if (success) {
      // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
      await app.start();
      
      // –î–µ–ª–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã–º –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
      window.guitarCombatApp = app;

      console.log("üé∏ Guitar Combat Application started successfully with optimized DI!");
      
      // –í—ã–≤–æ–¥–∏–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–∏—Å—Ç–µ–º—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
      console.log("üìä Dependency Injection Stats:", app.getDependencyStats());
    } else {
      console.error("‚ùå Failed to initialize Guitar Combat Application");
    }
  } catch (error) {
    console.error("‚ùå Failed to start application:", error);

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é –æ—à–∏–±–∫—É
    document.body.innerHTML = `
      <div class="flex items-center justify-center min-h-screen bg-gray-900">
        <div class="bg-red-500 text-white p-8 rounded-lg shadow-xl max-w-md">
          <h2 class="text-2xl font-bold mb-4">–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞</h2>
          <p class="mb-4">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.</p>
          <button onclick="location.reload()" class="bg-white text-red-500 px-6 py-2 rounded font-semibold hover:bg-gray-100">
            –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
          </button>
        </div>
      </div>
    `;
  }
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
window.addEventListener("beforeunload", async () => {
  if (app.isInitialized) {
    try {
      await app.shutdown();
    } catch (error) {
      console.warn("Warning: Failed to shutdown application:", error);
    }
  }
});

// –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª—è—Ö
export default app;
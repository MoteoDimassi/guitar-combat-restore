# Подробная дорожная карта для исправления логики метронома

## 1. Анализ и планирование
- [x] Проанализировать текущую логику в `js/components/Metronome.js`
- [x] Определить точки интеграции с `js/components/BeatRow.js` и `js/components/Playback.js`
- [x] Создать тестовые сценарии для проверки исправлений

## 2. Создание метода определения ударных стрелочек
- [x] Добавить метод `getMetronomeBeatIndices()` в `js/components/Metronome.js`
- [x] Реализовать логику:
  - [x] 4 стрелочки: [0, 1, 2, 3] (все стрелочки)
  - [x] 8 стрелочки: [0, 2, 4, 6] (каждая вторая, начиная с первой)
  - [x] 16 стрелочек: [0, 4, 8, 12] (каждая четвертая, начиная с первой)
- [ ] Добавить unit тесты для проверки логики

## 3. Исправление scheduler() в Metronome.js
- [x] Модифицировать метод `scheduler()` в `js/components/Metronome.js`
- [x] Модифицировать метод `nextNote()` в `js/components/Metronome.js`
- [x] Убедиться, что удары всегда на правильных стрелочках
- [x] Сохранить логику воспроизведения звуков для активных стрелочек
- [x] Проверить синхронизацию с визуальной подсветкой

## 4. Исправление обработчика выбора стрелочки
- [x] Модифицировать метод `onArrowClick()` в `js/components/BeatRow.js`
- [x] Убрать автоматическое влияние на удары метронома через `setCurrentBeat()`
- [x] Сохранить только визуальное выделение выбранной стрелочки
- [x] Добавить обновление глобального состояния без влияния на метроном

## 5. Улучшение визуальной подсветки
- [x] Модифицировать метод `setHighlightedIndices()` в `js/components/BeatRow.js`
- [x] Добавить метод `setMetronomeHighlight()` в `js/components/BeatRow.js` для отдельной подсветки ударов метронома
- [x] Создать визуальное различие между:
  - [x] Выбранной стрелочкой (одиночное выделение)
  - [x] Ударной стрелочкой (метроном)
  - [x] Активной стрелочкой (звук)

## 6. Интеграционное тестирование
- [x] Проверить работу с 4 стрелочками в `js/components/Metronome.js`
- [x] Проверить работу с 8 стрелочками в `js/components/Metronome.js`  
- [x] Проверить работу с 16 стрелочками в `js/components/Metronome.js`
- [x] Проверить выбор стрелочек без влияния на метроном в `js/components/BeatRow.js`
- [x] Проверить воспроизведение звуков только для активных стрелочек в `js/components/Metronome.js`

## 7. Поддержка будущего функционала
- [x] Создать гибкую систему длительностей метронома в `js/components/Metronome.js`
- [x] Добавить настройку темпа метронома в `js/components/Controls.js`
- [x] Подготовить архитектуру для расширения в `js/components/Metronome.js`

## 8. Документация и финальное тестирование
- [x] Обновить комментарии в коде в `js/components/Metronome.js` и `js/components/BeatRow.js`
- [x] Проверить обратную совместимость с существующим функционалом
- [x] Финальное тестирование всех сценариев в браузере
